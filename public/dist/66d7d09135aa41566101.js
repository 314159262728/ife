/*!
 * Copyright 2017 by Ding
 * @author Ding <ding-js@outlook.com>
 */
var ding3=webpackJsonpding_id_([3],{108:function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),t(258);var r=t(276),a=document.querySelector("#cropper"),h=document.querySelector("#preview"),o=document.querySelector("#file"),s=new r.Cropper(a,{preview:h});o.addEventListener("change",function(e){var i=e.target;""===i.value||i.files.length<1||s.changeImage(i.files[0])})},258:function(e,i){},276:function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r;!function(e){e[e.cropper=0]="cropper",e[e.image=1]="image",e[e.background=2]="background"}(r||(r={}));var a=function(){function e(e,i){var t=this;this._scaleOffset=0,this.handleImageMove=function(e){var i=[e.layerX,e.layerY],r=i[0],a=i[1],h=[t._xOffset,t._yOffset],o=h[0],s=h[1];t._imageX=r-o,t._imageY=a-s},this.handleCropperMove=function(e){var i=[e.layerX,e.layerY],r=i[0],a=i[1],h=[t._xOffset,t._yOffset,t._cropperWidth,t._cropperHeight,t._width,t._height],o=h[0],s=h[1],_=h[2],n=h[3],c=h[4],g=h[5],p=r-o,d=a-s;r<o&&(p=0),r>c-_+o&&(p=c-_),a<s&&(d=0),a>g-n+s&&(d=g-n),t._cropperX=p,t._cropperY=d},this._container=e,this._options=i,this.init()}return e.prototype.init=function(){var e=this,i=this._container,t=document.createElement("canvas"),a=t.getContext("2d");this._width=+i.offsetWidth,this._height=+i.offsetHeight,Object.assign(t,{width:this._width,height:this._height}),this._ctx=a,this._canvas=t,i.appendChild(t),t.addEventListener("mousewheel",function(i){var t=e._image;if(e._image){var r=t.width,a=t.height,h=e._scaleOffset+i.deltaY;if(e._scaleOffset=h,0!==h){var o=void 0;o=h>0?1/(1+h/800):1+Math.abs(h)/800,r*=o,a*=o,e._imageX+=(e._imageWidth-r)/2,e._imageY+=(e._imageHeight-a)/2,e._imageWidth=r,e._imageHeight=a}e.draw()}}),t.addEventListener("mousedown",function(i){if(1===i.which){var t=[i.layerX,i.layerY],a=t[0],h=t[1];e._moving=!0,a>e._cropperX&&a<e._cropperX+e._cropperWidth&&h>e._cropperY&&h<e._cropperY+e._cropperHeight?(e._xOffset=a-e._cropperX,e._yOffset=h-e._cropperY,e._area=r.cropper):a>e._imageX&&a<e._imageX+e._imageWidth&&h>e._imageY&&h<e._imageY+e._imageHeight?(e._xOffset=a-e._imageX,e._yOffset=h-e._imageY,e._area=r.image):(e._area=r.background,e._moving=!1)}}),window.addEventListener("mouseup",function(i){1===i.which&&(e._moving=!1)}),t.addEventListener("mousemove",function(i){if(e._moving){switch(e._area){case r.cropper:e.handleCropperMove(i);break;case r.image:e.handleImageMove(i);break;default:return}e.draw()}})},e.prototype.fillBackground=function(){var e=this._ctx,i=this._width,t=this._height,r=i/40,a=Math.ceil(i/r),h=Math.ceil(t/r);e.save(),e.fillStyle="#ccc";for(var o=0,s=0;s<h;s++)for(var _=0;_<a;_++)(o+s)%2==0&&e.fillRect(_*r,s*r,r,r),o++;e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(0,0,i,t),e.restore()},e.prototype.fillImage=function(){var e=this._ctx,i=this._image;i&&(void 0===this._imageWidth&&(this._imageWidth=i.width),void 0===this._imageHeight&&(this._imageHeight=i.height),void 0===this._imageX&&(this._imageX=(this._width-this._imageWidth)/2),void 0===this._imageY&&(this._imageY=(this._height-this._imageHeight)/2),e.drawImage(i,this._imageX,this._imageY,this._imageWidth,this._imageHeight))},e.prototype.fillCropper=function(){if(this._image){var e=this._ctx,i=this._image,t=i.width,r=i.height;e.save(),void 0===this._cropperWidth&&(this._cropperWidth=t/2),void 0===this._cropperHeight&&(this._cropperHeight=r/2),void 0===this._cropperX&&(this._cropperX=this._width/2-this._imageWidth/4),void 0===this._cropperY&&(this._cropperY=this._height/2-this._imageHeight/4),e.strokeStyle="#39f",e.lineWidth=1,e.strokeRect(this._cropperX,this._cropperY,this._cropperWidth,this._cropperHeight),e.restore()}},e.prototype.draw=function(){this._ctx.clearRect(0,0,this._width,this._height),this.fillBackground(),this.fillImage(),this.fillCropper()},e.prototype.changeImage=function(e){var i=this;if(!e.type.match(/^image\/.+$/))return void console.error("请选择正确的图片文件");var t=new FileReader;this._image=null,t.onload=function(e){var t=new Image;t.src=e.target.result,t.onload=function(){i._image=t,i._imageWidth=t.width,i._imageHeight=t.height,i.draw()}},t.readAsDataURL(e)},e}();i.Cropper=a},280:function(e,i,t){t(28),e.exports=t(108)}},[280]);